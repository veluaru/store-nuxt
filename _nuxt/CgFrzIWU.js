import{_ as H}from"./CfCdoYnI.js";import{v as M,y as $,e as j,z as U,A as W,B as G,C as Q,i as J,x as R,D as X,E as Y,q as B,G as F,H as Z,I as k,J as K,j as D,K as tt,g as at,k as et,s as nt,L as st,c as w,m as ot,b as L,d as V,a as y,t as P,w as rt,F as it,r as ct,M as lt,N as ut,o as S,O as dt,_ as _t}from"./rv5oAsuf.js";import{u as ft}from"./D1Cl_f_V.js";import{u as vt}from"./BdPfS82s.js";import{L as mt}from"./A1753duK.js";import"./EIFIQGdO.js";const ht={trailing:!0};function yt(t,a=25,i={}){if(i={...ht,...i},!Number.isFinite(a))throw new TypeError("Expected `wait` to be a finite number");let r,n,g=[],s,e;const v=(d,c)=>(s=gt(t,d,c),s.finally(()=>{if(s=null,i.trailing&&e&&!n){const p=v(d,e);return e=null,p}}),s),b=function(...d){return i.trailing&&(e=d),s||new Promise(c=>{const p=!n&&i.leading;clearTimeout(n),n=setTimeout(()=>{n=null;const u=i.leading?r:v(this,d);e=null;for(const f of g)f(u);g=[]},a),p?(r=v(this,d),c(r)):g.push(c)})},o=d=>{d&&(clearTimeout(d),n=null)};return b.isPending=()=>!!n,b.cancel=()=>{o(n),g=[],e=null},b.flush=()=>{if(o(n),!e||s)return;const d=e;return e=null,v(this,d)},b}async function gt(t,a,i){return await t.apply(a,i)}const bt=Symbol.for("nuxt:client-only");function Dt(...t){const a=typeof t[t.length-1]=="string"?t.pop():void 0;pt(t[0],t[1])&&t.unshift(a);let[i,r,n={}]=t,g=!1;const s=M(()=>$(i));if(typeof s.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof r!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const e=j();n.server??=!0,n.default??=Et,n.getCachedData??=I,n.lazy??=!1,n.immediate??=!0,n.deep??=U.deep,n.dedupe??="cancel",n._functionName,e._asyncData[s.value];function v(){const u={cause:"initial",dedupe:n.dedupe};return e._asyncData[s.value]?._init||(u.cachedData=n.getCachedData(s.value,e,{cause:"initial"}),e._asyncData[s.value]=q(e,s.value,r,n,u.cachedData)),()=>e._asyncData[s.value].execute(u)}const b=v(),o=e._asyncData[s.value];o._deps++;const d=n.server!==!1&&e.payload.serverRendered;{let u=function(l){const _=e._asyncData[l];_?._deps&&(_._deps--,_._deps===0&&_?._off())};const f=W();if(f&&d&&n.immediate&&!f.sp&&(f.sp=[]),f&&!f._nuxtOnBeforeMountCbs){f._nuxtOnBeforeMountCbs=[];const l=f._nuxtOnBeforeMountCbs;G(()=>{l.forEach(_=>{_()}),l.splice(0,l.length)}),Q(()=>l.splice(0,l.length))}const E=f&&(f._nuxtClientOnly||J(bt,!1));d&&e.isHydrating&&(o.error.value||o.data.value!==void 0)?o.status.value=o.error.value?"error":"success":f&&(!E&&e.payload.serverRendered&&e.isHydrating||n.lazy)&&n.immediate?f._nuxtOnBeforeMountCbs.push(b):n.immediate&&o.status.value!=="success"&&b();const h=Y(),m=R(s,(l,_)=>{if((l||_)&&l!==_){g=!0;const x=e._asyncData[_]?.data.value!==void 0,z=e._asyncDataPromises[_]!==void 0,T={cause:"initial",dedupe:n.dedupe};if(!e._asyncData[l]?._init){let O;_&&x?O=e._asyncData[_].data.value:(O=n.getCachedData(l,e,{cause:"initial"}),T.cachedData=O),e._asyncData[l]=q(e,l,r,n,O)}e._asyncData[l]._deps++,_&&u(_),(n.immediate||x||z)&&e._asyncData[l].execute(T),tt(()=>{g=!1})}},{flush:"sync"}),C=n.watch?R(n.watch,()=>{g||o._execute({cause:"watch",dedupe:n.dedupe})}):()=>{};h&&X(()=>{m(),C(),u(s.value)})}const c={data:N(()=>e._asyncData[s.value]?.data),pending:N(()=>e._asyncData[s.value]?.pending),status:N(()=>e._asyncData[s.value]?.status),error:N(()=>e._asyncData[s.value]?.error),refresh:(...u)=>e._asyncData[s.value]?._init?e._asyncData[s.value].execute(...u):v()(),execute:(...u)=>c.refresh(...u),clear:()=>{const u=e._asyncData[s.value];if(u?._abortController)try{u._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{u._abortController=void 0}A(e,s.value)}},p=Promise.resolve(e._asyncDataPromises[s.value]).then(()=>c);return Object.assign(p,c),p}function N(t){return M({get(){return t()?.value},set(a){const i=t();i&&(i.value=a)}})}function pt(t,a){return!(typeof t=="string"||typeof t=="object"&&t!==null||typeof t=="function"&&typeof a=="function")}function A(t,a){a in t.payload.data&&(t.payload.data[a]=void 0),a in t.payload._errors&&(t.payload._errors[a]=void 0),t._asyncData[a]&&(t._asyncData[a].data.value=D(t._asyncData[a]._default()),t._asyncData[a].error.value=void 0,t._asyncData[a].status.value="idle"),a in t._asyncDataPromises&&(t._asyncDataPromises[a]=void 0)}function Ct(t,a){const i={};for(const r of a)i[r]=t[r];return i}function q(t,a,i,r,n){t.payload._errors[a]??=void 0;const g=r.getCachedData!==I,s=i,e=r.deep?B:F,v=n!==void 0,b=t.hook("app:data:refresh",async d=>{(!d||d.includes(a))&&await o.execute({cause:"refresh:hook"})}),o={data:e(v?n:r.default()),pending:M(()=>o.status.value==="pending"),error:Z(t.payload._errors,a),status:F("idle"),execute:(...d)=>{const[c,p=void 0]=d,u=c&&p===void 0&&typeof c=="object"?c:{};if(t._asyncDataPromises[a]&&(u.dedupe??r.dedupe)==="defer")return t._asyncDataPromises[a];{const h="cachedData"in u?u.cachedData:r.getCachedData(a,t,{cause:u.cause??"refresh:manual"});if(h!==void 0)return t.payload.data[a]=o.data.value=h,o.error.value=void 0,o.status.value="success",Promise.resolve(h)}o._abortController&&o._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),o._abortController=new AbortController,o.status.value="pending";const f=new AbortController,E=new Promise((h,m)=>{try{const C=u.timeout??r.timeout,l=wt([o._abortController?.signal,u?.signal],f.signal,C);if(l.aborted){const _=l.reason;m(_ instanceof Error?_:new DOMException(String(_??"Aborted"),"AbortError"));return}return l.addEventListener("abort",()=>{const _=l.reason;m(_ instanceof Error?_:new DOMException(String(_??"Aborted"),"AbortError"))},{once:!0,signal:f.signal}),Promise.resolve(s(t,{signal:l})).then(h,m)}catch(C){m(C)}}).then(async h=>{let m=h;r.transform&&(m=await r.transform(h)),r.pick&&(m=Ct(m,r.pick)),t.payload.data[a]=m,o.data.value=m,o.error.value=void 0,o.status.value="success"}).catch(h=>{if(!(t._asyncDataPromises[a]&&t._asyncDataPromises[a]!==E)&&!o._abortController?.signal.aborted){if(typeof DOMException<"u"&&h instanceof DOMException&&h.name==="AbortError"){o.status.value="idle";return}o.error.value=K(h),o.data.value=D(r.default()),o.status.value="error"}}).finally(()=>{f.abort(),delete t._asyncDataPromises[a]});return t._asyncDataPromises[a]=E,t._asyncDataPromises[a]},_execute:yt((...d)=>o.execute(...d),0,{leading:!0}),_default:r.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{b(),t._asyncData[a]?._init&&(t._asyncData[a]._init=!1),g||k(()=>{t._asyncData[a]?._init||(A(t,a),o.execute=()=>Promise.resolve())})}};return o}const Et=()=>{},I=(t,a,i)=>{if(a.isHydrating)return a.payload.data[t];if(i.cause!=="refresh:manual"&&i.cause!=="refresh:hook")return a.static.data[t]};function wt(t,a,i){const r=t.filter(s=>!!s);if(typeof i=="number"&&i>=0){const s=AbortSignal.timeout?.(i);s&&r.push(s)}if(AbortSignal.any)return AbortSignal.any(r);const n=new AbortController;for(const s of r)if(s.aborted){const e=s.reason??new DOMException("Aborted","AbortError");try{n.abort(e)}catch{n.abort()}return n.signal}const g=()=>{const e=r.find(v=>v.aborted)?.reason??new DOMException("Aborted","AbortError");try{n.abort(e)}catch{n.abort()}};for(const s of r)s.addEventListener?.("abort",g,{once:!0,signal:a});return n.signal}const Pt={class:"detail-container"},St={key:0,class:"detail-container__loading-message"},Ot={key:1,class:"detail-container__not-found-message"},Nt={class:"detail-container__not-found-message__text-error"},Mt={key:2,class:"product-container"},Bt={class:"product-container__gallery-col"},xt=["src","alt"],Tt={class:"product-container__gallery-col__thumbnail-gallery"},Rt=["src","alt","onClick"],Ft={class:"product-container__details-col"},Lt={class:"product-container__details-col__name"},Vt={class:"product-container__details-col__price"},qt={class:"product-container__details-col__category-tag"},At={class:"product-container__details-col__quantity-selector"},It=["disabled"],zt={class:"product-container__details-col__quantity-value"},Ht={class:"product-container__details-col__description"},$t=at({__name:"[id]",async setup(t){let a,i;const r=ft(),n=vt(),g=ut(),s=lt(),e=M(()=>Number(g.params.id)),v=B(1),b=B(null),{pending:o,error:d}=([a,i]=et(()=>Dt(`product-${e.value}`,()=>n.getProductById(e.value),{lazy:!0})),a=await a,i(),a),{currentProduct:c}=nt(n);st(()=>{c.value&&c.value.images.length>0&&(b.value=c.value.images[0]||null)});function p(){v.value++}function u(){v.value>1&&v.value--}function f(){if(c.value){for(let h=0;h<v.value;h++)r.addProduct(c.value);v.value=1}}function E(){f(),s.push("/cart")}return(h,m)=>{const C=H;return S(),w("div",Pt,[D(o)?(S(),w("div",St,[L(mt),m[0]||(m[0]=V(" Cargando... ",-1))])):D(d)?(S(),w("div",Ot,[y("h1",Nt,"Error: "+P(D(d).message),1),L(C,{to:"/",class:"detail-container__not-found-message__back-link"},{default:rt(()=>[...m[1]||(m[1]=[V("Volver a la lista",-1)])]),_:1})])):D(c)?(S(),w("div",Mt,[y("div",Bt,[y("img",{src:b.value||D(c).images[0],alt:D(c).title,class:"product-container__gallery-col__main-image"},null,8,xt),y("div",Tt,[(S(!0),w(it,null,ct(D(c).images,l=>(S(),w("img",{key:l,src:l,alt:`${D(c).title} thumbnail`,class:dt([{active:l===b.value},"product-container__gallery-col__thumbnail-image"]),onClick:_=>b.value=l},null,10,Rt))),128))])]),y("div",Ft,[y("h1",Lt,P(D(c).title),1),y("p",Vt,"$"+P(D(c).price.toFixed(2)),1),y("p",qt,"Categoría: "+P(D(c).category.name),1),y("div",At,[y("button",{onClick:u,disabled:v.value<=1,class:"product-container__details-col__quantity-button"},"-",8,It),y("span",zt,P(v.value),1),y("button",{onClick:p,class:"product-container__details-col__quantity-button"},"+")]),y("div",{class:"button-group"},[y("button",{onClick:E,class:"button-group__buy-now-button"}," Comprar Ahora "),y("button",{onClick:f,class:"button-group__add-to-cart-button"}," Agregar al Carrito ")]),y("div",Ht,[m[2]||(m[2]=y("h2",null,"Descripción",-1)),y("p",null,P(D(c).description),1)])])])):ot("",!0)])}}}),Xt=_t($t,[["__scopeId","data-v-caa09ff4"]]);export{Xt as default};
